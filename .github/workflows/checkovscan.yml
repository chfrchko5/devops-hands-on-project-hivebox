name: scan of k8s resources

on:
    push:
        branches:
            - main
        paths:
            - 'kubernetes/**'

jobs:
    k8s-scan:
        permissions:
          contents: read
          security-events: write
          actions: read

        runs-on: ubuntu-latest

        steps:
        - name: checkout repo
          uses: actions/checkout@v4
      
        - name: checkov scan
          uses: bridgecrewio/checkov-action@v12
          with:
            output_format: cli,sarif
            output_file_path: console,results.sarif
        
        - name: sarif upload to github
          uses: github/codeql-action/upload-sarif@v3
          if: success() || failure()
          with:
            sarif_file: results.sarif